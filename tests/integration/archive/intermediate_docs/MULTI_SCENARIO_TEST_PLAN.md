# PyHYSPLIT vs HYSPLIT Web 다중 시나리오 비교 테스트 계획

## 목적

PyHYSPLIT 구현이 다양한 기상 조건과 지역에서 HYSPLIT Web과 얼마나 일치하는지 정밀하게 검증합니다.

## 테스트 시나리오

### 1. 서울 겨울철 Backward (기준 케이스)
- **위치**: 37.5°N, 127.0°E (서울)
- **시작 시간**: 2026-02-13 13:00 UTC
- **고도**: 850m AGL
- **기간**: 7시간 backward
- **특징**: 겨울철 북서풍 패턴, 중국발 대기오염 추적
- **기대**: 북서쪽으로 이동, 고도 하강

### 2. 서울 여름철 Forward
- **위치**: 37.5°N, 127.0°E (서울)
- **시작 시간**: 2024-07-15 09:00 UTC
- **고도**: 500m AGL
- **기간**: 12시간 forward
- **특징**: 여름철 남동풍 패턴, 태평양 기단 영향
- **기대**: 남동쪽으로 이동, 해양 방향

### 3. 부산 봄철 Backward (장거리)
- **위치**: 35.1°N, 129.0°E (부산)
- **시작 시간**: 2024-04-10 15:00 UTC
- **고도**: 1500m AGL
- **기간**: 24시간 backward
- **특징**: 봄철 황사 시즌, 장거리 수송
- **기대**: 서쪽 또는 북서쪽으로 장거리 이동

## 비교 지표

### 1. 수평 거리 차이
- **평균 거리 차이**: 모든 포인트에서 PyHYSPLIT과 HYSPLIT Web 간 수평 거리
- **최대 거리 차이**: 가장 큰 차이를 보이는 포인트
- **종료점 거리**: 최종 위치의 차이 (가장 중요)

### 2. 고도 차이
- **평균 고도 차이**: 모든 포인트에서의 고도 차이
- **최대 고도 차이**: 가장 큰 고도 차이

### 3. 궤적 형태
- **위도/경도 차이 패턴**: 시간에 따른 차이 변화
- **이동 방향 일치도**: 전체적인 이동 패턴 유사성

## 평가 기준

| 평균 거리 차이 | 평가 | 설명 |
|----------------|------|------|
| < 10 km | ⭐⭐⭐⭐⭐ 매우 우수 | HYSPLIT과 거의 동일 |
| < 50 km | ⭐⭐⭐⭐ 우수 | 실용적으로 매우 유사 |
| < 100 km | ⭐⭐⭐ 양호 | 일반 용도로 사용 가능 |
| < 200 km | ⭐⭐ 허용 | 개선 필요하나 참고 가능 |
| ≥ 200 km | ⭐ 개선 필요 | 추가 검증 및 개선 필요 |

## 실행 방법

```bash
# 다중 시나리오 테스트 실행
python tests/integration/test_multi_scenario_comparison.py
```

## 출력 결과

### 1. 시각화 (각 시나리오별)
- `comparison_seoul_winter_backward.png`
- `comparison_seoul_summer_forward.png`
- `comparison_busan_spring_backward.png`

각 시각화는 6개 서브플롯 포함:
1. 궤적 경로 오버레이
2. 고도 프로파일 비교
3. 수평 거리 차이
4. 고도 차이
5. 위도 차이
6. 경도 차이

### 2. 요약 리포트
- `MULTI_SCENARIO_COMPARISON_SUMMARY.md`: 전체 시나리오 요약 및 분석

### 3. JSON 결과
- `comparison_results.json`: 수치 데이터 (프로그래밍 방식 접근용)

## 현재 상태

### 완료된 작업
✅ 다중 시나리오 테스트 프레임워크 구축
✅ 3가지 시나리오 정의
✅ 자동 시각화 및 리포트 생성
✅ NetCDFReader 버그 수정 (변수 이름 매칭)

### 발견된 문제
❌ PyHYSPLIT이 2개 포인트만 생성 (예상: 8개)
❌ 첫 번째 스텝 후 "Heun step boundary error" 발생
❌ 고도가 850m에서 249m로 급격히 하강

### 원인 분석
1. **고도 단위 변환 문제**: 850m AGL을 기압면 좌표계(hPa)로 변환 필요
2. **보간 오류**: 고도 변환 후 보간기가 올바른 값을 찾지 못함
3. **경계 처리**: 변환된 고도가 z_grid 범위를 벗어남

## 다음 단계

### 1. 고도 변환 수정 (최우선)
- [ ] CoordinateConverter의 height_to_pressure 함수 검증
- [ ] 보간기가 AGL 고도를 기압으로 올바르게 변환하는지 확인
- [ ] 테스트 케이스 추가

### 2. 경계 처리 개선
- [ ] z_grid 범위 체크 강화
- [ ] 경계 오류 시 더 나은 로깅
- [ ] 경계 근처에서의 보간 안정성 개선

### 3. 실제 HYSPLIT Web 데이터 수집
- [ ] hysplit_web_full_automation.py를 각 시나리오에 적용
- [ ] 실제 HYSPLIT Web 결과 파일 저장
- [ ] 시뮬레이션 데이터 대신 실제 데이터 사용

### 4. 추가 시나리오
- [ ] 다양한 고도 (100m, 500m, 1500m, 3000m)
- [ ] 다양한 기간 (3h, 12h, 24h, 48h)
- [ ] 다양한 계절 및 지역

## 기대 효과

이 다중 시나리오 테스트를 통해:
1. PyHYSPLIT의 정확도를 정량적으로 평가
2. 특정 조건에서의 강점/약점 파악
3. 개선이 필요한 영역 식별
4. 사용자에게 신뢰할 수 있는 검증 결과 제공
