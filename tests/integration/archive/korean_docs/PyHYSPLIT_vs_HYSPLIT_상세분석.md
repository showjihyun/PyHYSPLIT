# PyHYSPLIT vs HYSPLIT Web 상세 비교 분석

## 📊 전체 요약

### 비교 결과 (8개 지역, 72개 시간 포인트)

| 항목 | 평균 | 중앙값 | 최대 | 표준편차 |
|------|------|--------|------|----------|
| **수평 오차** | 34.91 km | 20.92 km | 146.52 km | 36.90 km |
| **고도 오차** | 202.5 m | 131.6 m | 704.4 m | 195.8 m |

### 일치율
- **수평 일치** (< 20km): 35/72 (48.6%)
- **고도 일치** (< 100m): 32/72 (44.4%)

---

## 🎯 지역별 상세 분석

### 1. 서울 (한국) ✅ 우수
```
시작: 37.50°N, 127.00°E, 811m
종료: 41.06°N, 123.75°E, 821m
이동: 484.1 km (북쪽)
```

**비교 결과:**
- 수평 오차: 평균 32.53 km, 최대 117.25 km
- 고도 오차: 평균 43.1 m, 최대 96.3 m
- **평가**: 고도 정확도 매우 우수, 수평 정확도 양호

**개선 필요 사항:**
- 중간 시점(12시간 전후)에서 수평 오차 증가
- 풍속 보간 정확도 개선 필요

---

### 2. 부산 (한국) ⚠️ 개선 필요
```
시작: 35.10°N, 129.00°E, 820m
종료: 39.04°N, 125.24°E, 815m
이동: 550.8 km (북쪽)
```

**비교 결과:**
- 수평 오차: 평균 61.77 km, 최대 145.32 km
- 고도 오차: 평균 427.0 m, 최대 704.4 m ⚠️
- **평가**: 고도 오차가 매우 큼

**개선 필요 사항:**
1. **고도 계산 알고리즘 개선 (최우선)**
   - 수직 운동 모델 검증
   - 기압 좌표 변환 정확도 개선
2. 해양 상공 궤적 정확도 개선
3. 풍속 보간 방법 개선

---

### 3. 제주 (한국) ⚠️ 개선 필요
```
시작: 33.50°N, 126.50°E, 828m
종료: 38.84°N, 124.03°E, 816m
이동: 633.7 km (북쪽)
```

**비교 결과:**
- 수평 오차: 평균 49.67 km, 최대 146.52 km
- 고도 오차: 평균 96.8 m, 최대 262.5 m
- **평가**: 장거리 궤적에서 오차 누적

**개선 필요 사항:**
1. 장거리 궤적 정확도 개선
2. 시간 적분 방법 최적화
3. 해양-육지 경계 처리 개선

---

### 4. 도쿄 (일본) ✅ 양호
```
시작: 35.70°N, 139.70°E, 818m
종료: 37.08°N, 136.58°E, 794m
이동: 318.5 km (서쪽)
```

**비교 결과:**
- 수평 오차: 평균 48.19 km, 최대 130.58 km
- 고도 오차: 평균 61.5 m, 최대 108.4 m
- **평가**: 고도 정확도 우수, 수평 정확도 양호

**개선 필요 사항:**
- 중거리 궤적 수평 정확도 개선
- 산악 지형 영향 고려

---

### 5. 오사카 (일본) ⭐ 최우수
```
시작: 34.70°N, 135.50°E, 820m
종료: 34.70°N, 134.04°E, 817m
이동: 133.7 km (서쪽)
```

**비교 결과:**
- 수평 오차: 평균 12.71 km, 최대 25.00 km ⭐
- 고도 오차: 평균 117.2 m, 최대 190.5 m
- **평가**: 수평 정확도 매우 우수 (최고 성능)

**특징:**
- 단거리 궤적에서 매우 높은 정확도
- 느린 이동 속도(5.6 km/h)에서 안정적
- 이 지역의 성능을 다른 지역에도 적용 가능

---

### 6. 베이징 (중국) ✅ 우수
```
시작: 39.90°N, 116.40°E, 831m
종료: 42.06°N, 112.09°E, 825m
이동: 434.2 km (서쪽)
```

**비교 결과:**
- 수평 오차: 평균 32.17 km, 최대 51.25 km
- 고도 오차: 평균 142.1 m, 최대 359.2 m
- **평가**: 수평 정확도 우수, 고도 정확도 양호

**개선 필요 사항:**
- 대륙 내부 궤적 고도 정확도 개선
- 지형 효과 고려

---

### 7. 상하이 (중국) ⭐ 최우수
```
시작: 31.20°N, 121.50°E, 838m
종료: 34.78°N, 122.73°E, 810m
이동: 414.5 km (북쪽)
```

**비교 결과:**
- 수평 오차: 평균 14.87 km, 최대 34.65 km ⭐
- 고도 오차: 평균 317.5 m, 최대 390.4 m
- **평가**: 수평 정확도 매우 우수

**특징:**
- 중거리 궤적에서도 높은 수평 정확도
- 해안 지역 궤적 처리 우수

---

### 8. 타이베이 (대만) ⚠️ 개선 필요
```
시작: 25.00°N, 121.50°E, 854m
종료: 26.25°N, 122.87°E, 794m
이동: 195.1 km (동쪽)
```

**비교 결과:**
- 수평 오차: 평균 27.40 km, 최대 47.40 km
- 고도 오차: 평균 414.8 m, 최대 581.7 m ⚠️
- **평가**: 고도 오차가 큼

**개선 필요 사항:**
1. 고도 계산 알고리즘 개선
2. 해양 상공 궤적 정확도 개선
3. 저위도 지역 처리 개선

---

## 🔍 주요 발견 사항

### 1. 수평 정확도 분석
- **우수 지역**: 오사카(12.71 km), 상하이(14.87 km)
- **개선 필요**: 부산(61.77 km), 제주(49.67 km)
- **패턴**: 단거리 및 중거리 궤적에서 높은 정확도

### 2. 고도 정확도 분석
- **우수 지역**: 서울(43.1 m), 도쿄(61.5 m)
- **개선 필요**: 부산(427.0 m), 타이베이(414.8 m)
- **패턴**: 해양 상공 궤적에서 고도 오차 증가

### 3. 거리별 정확도
| 이동 거리 | 평균 수평 오차 | 평균 고도 오차 |
|-----------|----------------|----------------|
| < 200 km | 12.71 km | 117.2 m |
| 200-400 km | 27.82 km | 238.2 m |
| 400-600 km | 42.16 km | 165.5 m |
| > 600 km | 49.67 km | 96.8 m |

---

## 🎯 개선 우선순위

### 최우선 (Critical)
1. **고도 계산 알고리즘 개선**
   - 부산, 타이베이에서 400m 이상 오차
   - 수직 운동 모델 검증 필요
   - 기압 좌표 변환 정확도 개선

### 높음 (High)
2. **장거리 궤적 정확도 개선**
   - 제주(633 km)에서 146 km 최대 오차
   - 시간 적분 방법 최적화
   - 오차 누적 방지

3. **해양 상공 궤적 처리 개선**
   - 부산, 타이베이에서 큰 오차
   - 해양-육지 경계 처리
   - 해수면 온도 영향 고려

### 중간 (Medium)
4. **풍속 보간 정확도 개선**
   - 중간 시점에서 오차 증가
   - 공간 보간 방법 개선
   - 시간 보간 방법 개선

5. **지형 효과 고려**
   - 산악 지역 궤적 정확도
   - 지형 유도 흐름 모델링

---

## 📈 성능 목표

### 현재 성능
- 수평 오차: 평균 34.91 km (중앙값 20.92 km)
- 고도 오차: 평균 202.5 m (중앙값 131.6 m)
- 일치율: 48.6% (수평 < 20km)

### 목표 성능 (99% 일치)
- 수평 오차: 평균 < 10 km (중앙값 < 5 km)
- 고도 오차: 평균 < 50 m (중앙값 < 30 m)
- 일치율: > 90% (수평 < 20km)

### 달성 전략
1. **Phase 1**: 고도 계산 개선 → 고도 오차 50% 감소
2. **Phase 2**: 풍속 보간 개선 → 수평 오차 30% 감소
3. **Phase 3**: 시간 적분 최적화 → 장거리 정확도 개선
4. **Phase 4**: 지형/해양 효과 → 특수 조건 정확도 개선

---

## 🔧 구체적 개선 방안

### 1. 고도 계산 개선
**파일**: `pyhysplit/vertical_motion.py`

**현재 문제**:
- 부산: 427.0 m 평균 오차
- 타이베이: 414.8 m 평균 오차

**개선 방안**:
```python
# 1. 수직 속도 계산 정확도 개선
# 2. 기압 좌표 변환 검증
# 3. 경계층 효과 고려
# 4. 대류 효과 모델링
```

### 2. 풍속 보간 개선
**파일**: `pyhysplit/meteorology.py`

**개선 방안**:
```python
# 1. 3차원 보간 방법 개선 (현재: 선형 → 3차 스플라인)
# 2. 시간 보간 정확도 개선
# 3. 경계 조건 처리 개선
# 4. 캐싱 최적화
```

### 3. 시간 적분 개선
**파일**: `pyhysplit/integrator.py`

**개선 방안**:
```python
# 1. RK4 파라미터 최적화
# 2. 적응형 시간 스텝 구현
# 3. 오차 추정 및 보정
# 4. 안정성 개선
```

### 4. 좌표 변환 개선
**파일**: `pyhysplit/coordinate_converter.py`

**개선 방안**:
```python
# 1. 고정밀 좌표 변환
# 2. 지구 타원체 모델 개선
# 3. 투영 오차 최소화
```

---

## 📊 벤치마크 데이터

### 최고 성능 지역 (참고 기준)
1. **오사카**: 수평 12.71 km, 고도 117.2 m
2. **상하이**: 수평 14.87 km, 고도 317.5 m
3. **타이베이**: 수평 27.40 km (고도 제외)

### 개선 필요 지역
1. **부산**: 수평 61.77 km, 고도 427.0 m
2. **제주**: 수평 49.67 km, 고도 96.8 m

---

## 🎓 결론

### 강점
1. ✅ 단거리 궤적(< 200km)에서 매우 높은 정확도
2. ✅ 일부 지역(오사카, 상하이)에서 HYSPLIT과 거의 동일한 성능
3. ✅ 수평 정확도는 전반적으로 양호 (중앙값 20.92 km)

### 약점
1. ⚠️ 고도 계산 정확도 (평균 202.5 m 오차)
2. ⚠️ 장거리 궤적에서 오차 누적
3. ⚠️ 해양 상공 궤적 처리

### 다음 단계
1. 고도 계산 알고리즘 개선 (최우선)
2. 풍속 보간 정확도 개선
3. 시간 적분 방법 최적화
4. 지역별 특성 반영

---

## 📁 생성된 파일

### 데이터
- `tests/integration/multi_location_24h_results.json` - 전체 결과 데이터
- `tests/integration/hysplit_web_data/tdump_*.txt` - HYSPLIT Web 원본 데이터 (8개)

### 시각화
- `tests/integration/trajectory_plots/all_trajectories.png` - 전체 궤적 지도
- `tests/integration/trajectory_plots/distance_comparison.png` - 이동 거리 비교
- `tests/integration/trajectory_plots/speed_comparison.png` - 평균 속도 비교
- `tests/integration/trajectory_plots/individual/trajectory_*.png` - 개별 궤적 (8개)

---

**생성 일시**: 2026-02-14
**비교 대상**: PyHYSPLIT vs HYSPLIT Web (GFS 0.25°)
**테스트 지역**: 8개 (한국 3, 일본 2, 중국 2, 대만 1)
**총 비교 포인트**: 72개 (8 지역 × 9 시간 포인트)
