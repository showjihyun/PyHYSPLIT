# 실제 HYSPLIT Web 데이터로 비교하기

## 현재 상태

✅ **완료된 작업:**
- PyHYSPLIT 8개 지역 24시간 역추적 완료
- 샘플 데이터로 비교 기능 테스트 완료
- 비교 인프라 준비 완료

⚠️ **현재 문제:**
- 샘플 데이터 사용 중 (실제 HYSPLIT Web 아님)
- 오차: 평균 100km (실제는 40-50km 예상)
- 자동화 스크립트가 HYSPLIT Web 페이지 구조 변경으로 작동 안 함

## 실제 HYSPLIT Web 데이터가 필요한 이유

### 1. 정확한 비교
- 샘플 데이터: 평균 100km 오차 (랜덤 오차 추가)
- 실제 데이터: 평균 40-50km 오차 예상 (95-97% 일치)

### 2. 파라미터 최적화
- 실제 오차 패턴 분석 필요
- 어떤 파라미터를 조정해야 하는지 파악
- 99% 일치 목표 달성

### 3. 검증
- PyHYSPLIT이 실제로 HYSPLIT과 얼마나 일치하는지 확인
- 과학적 신뢰성 검증

## 옵션 1: 수동 다운로드 (권장) ⭐

가장 확실하고 빠른 방법입니다 (30-60분 소요).

### 단계별 가이드

**1. 도우미 스크립트 실행**
```bash
python tests\integration\hysplit_web_helper.py
```

이 스크립트는:
- 8개 지역의 정확한 좌표 제공
- 복사-붙여넣기 가능한 설정 값
- 단계별 체크리스트
- 다운로드 진행 상황 확인

**2. HYSPLIT Web 접속**
```
https://www.ready.noaa.gov/HYSPLIT_traj.php
```

**3. 공통 설정 (모든 지역 동일)**
- Meteorology: GFS (0.25 degree)
- Start Time: 2026-02-14 00:00 UTC
- Direction: Backward
- Duration: 24 hours
- Vertical Motion: Model Vertical Velocity
- Output Interval: 1 hour

**4. 각 지역 실행 (8개)**

| 순서 | 지역 | 위도 | 경도 | 고도 | 소요 시간 |
|------|------|------|------|------|----------|
| 1 | 서울 | 37.5 | 127.0 | 850 | 3-5분 |
| 2 | 부산 | 35.1 | 129.0 | 850 | 3-5분 |
| 3 | 제주 | 33.5 | 126.5 | 850 | 3-5분 |
| 4 | 도쿄 | 35.7 | 139.7 | 850 | 3-5분 |
| 5 | 오사카 | 34.7 | 135.5 | 850 | 3-5분 |
| 6 | 베이징 | 39.9 | 116.4 | 850 | 3-5분 |
| 7 | 상하이 | 31.2 | 121.5 | 850 | 3-5분 |
| 8 | 타이베이 | 25.0 | 121.5 | 850 | 3-5분 |

각 지역마다:
1. 위도/경도/고도 입력
2. Run 클릭
3. 계산 완료 대기 (1-2분)
4. "Trajectory Endpoints" 다운로드
5. 파일명을 `tdump_<지역명>.txt`로 변경
6. `tests\integration\hysplit_web_data\`에 저장

**5. 비교 실행**
```bash
python tests\integration\multi_location_24h_comparison.py --compare
```

## 옵션 2: 자동화 스크립트 수정 (고급)

HYSPLIT Web 페이지 구조가 변경되어 현재 자동화 스크립트가 작동하지 않습니다.

### 문제점
- `https://www.ready.noaa.gov/HYSPLIT_traj.php` 페이지가 팝업을 사용
- input/select 요소가 동적으로 로드됨
- 페이지 구조가 복잡함

### 수정 방법
1. 실제 페이지 HTML 구조 분석
2. 올바른 selector 찾기
3. 팝업 처리 로직 추가
4. 동적 로딩 대기 시간 추가

### 필요한 작업
```python
# 페이지 구조 분석
python tests\integration\inspect_hysplit_web.py

# HTML 파일 확인
# tests\integration\hysplit_web_page.html

# 스크립트 수정
# tests\integration\download_hysplit_web_data.py
```

## 옵션 3: 대안 URL 사용

`hysplit_web_full_automation.py`가 사용하는 다른 워크플로우:

```
1. https://www.ready.noaa.gov/hypub-bin/trajsrc.pl
2. Meteorology 선택
3. Next 버튼
4. Forecast Cycle 선택
5. https://www.ready.noaa.gov/hypub-bin/traj1.pl
6. 설정 입력 및 실행
```

이 방법은 더 복잡하지만 자동화가 가능할 수 있습니다.

## 현재 샘플 데이터 비교 결과

### 전체 통계
- 수평 오차: 평균 99.80 km, 최대 260.60 km
- 고도 오차: 평균 68.7 m, 최대 296.0 m
- 일치율: 수평 6.5%, 고도 74.5%

### 실제 HYSPLIT Web 비교 시 예상
- 수평 오차: 평균 40-50 km (현재의 절반)
- 고도 오차: 평균 150-180 m (현재의 2배)
- 일치율: 95-97% (크게 향상)

## 권장 사항

### 즉시 실행 가능 (30-60분)
**옵션 1: 수동 다운로드**를 권장합니다.

이유:
- 가장 확실함
- 빠름 (30-60분)
- 실패 위험 없음
- 도우미 스크립트가 모든 것을 안내

### 자동화는 나중에
자동화 스크립트 수정은:
- 시간이 오래 걸림 (2-3시간)
- 페이지 구조 분석 필요
- 실패 가능성 있음
- 한 번만 사용할 가능성 높음

## 실행 순서

```bash
# 1. 도우미 스크립트 실행
python tests\integration\hysplit_web_helper.py

# 2. 브라우저에서 HYSPLIT Web 접속
#    https://www.ready.noaa.gov/HYSPLIT_traj.php

# 3. 8개 지역 각각 실행 (30-60분)
#    - 도우미 스크립트의 가이드 따라하기
#    - 체크리스트 사용: tests\integration\hysplit_web_data\CHECKLIST.txt

# 4. 진행 상황 확인
python tests\integration\hysplit_web_helper.py

# 5. 모두 완료 후 비교 실행
python tests\integration\multi_location_24h_comparison.py --compare
```

## 예상 결과 (실제 데이터)

### 지역별 예상 오차

| 지역 | 이동 거리 | 예상 수평 오차 | 예상 고도 오차 |
|------|----------|--------------|--------------|
| 서울 | 484 km | 40-50 km | 150-180 m |
| 부산 | 551 km | 45-55 km | 160-190 m |
| 제주 | 634 km | 50-65 km | 170-210 m |
| 도쿄 | 319 km | 30-40 km | 130-160 m |
| 오사카 | 134 km | 15-25 km | 100-130 m |
| 베이징 | 434 km | 40-50 km | 150-180 m |
| 상하이 | 414 km | 40-50 km | 150-180 m |
| 타이베이 | 195 km | 20-30 km | 110-140 m |

### 전체 통계 예상
- 수평 오차: 평균 40-50 km
- 고도 오차: 평균 150-180 m
- 일치율: 95-97%

## 비교 후 다음 단계

### 1. 결과 분석
- 오차 패턴 파악
- 지역별/시간별 분석
- 개선 방향 도출

### 2. 파라미터 최적화
```bash
python tests\integration\quick_optimize.py
```
- 목표: 97-98% 일치

### 3. 알고리즘 개선
- Tricubic 보간
- Cubic spline 시간 보간
- 목표: 98-99% 일치

### 4. 최종 목표
- 99%+ 일치 달성
- 과학적 검증 완료

## 문의 및 도움

### 문서
- `다음_단계_실행_가이드.md` - 상세 가이드
- `HYSPLIT_WEB_BATCH_GUIDE.md` - HYSPLIT Web 가이드
- `hysplit_web_data/CHECKLIST.txt` - 체크리스트
- `샘플_비교_결과.md` - 현재 샘플 비교 결과

### 스크립트
- `hysplit_web_helper.py` - 도우미 스크립트
- `multi_location_24h_comparison.py --compare` - 비교 실행

### 문제 해결
1. 도우미 스크립트 재실행
2. 체크리스트 확인
3. 문서 참조
4. 이슈 생성

---

**작성일:** 2026-02-14  
**상태:** 수동 다운로드 대기 중  
**예상 소요 시간:** 30-60분  
**권장 방법:** 옵션 1 (수동 다운로드)
